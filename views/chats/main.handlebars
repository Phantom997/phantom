<!DOCTYPE html>
<head>
  <title>Pusher Test</title>
  <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
  <script>

    // Enable pusher logging - don't include this in production
    Pusher.logToConsole = true;

    var pusher = new Pusher('9feca0caa7a1854d8f87', {
      cluster: 'ap2'
    });
    var channel = pusher.subscribe('my-channel');
    channel.bind("{{chatId}}", function(data) {
      document.getElementById("messages").value +=  "\n"+ data.name + ": " + data.message
    });
    setInterval(function(){
        var textarea = document.getElementById('messages');
        textarea.scrollTop = textarea.scrollHeight;
    }, 2000);
    $(document).ready(function () {
        $('#myform').on('submit', function(e) {
            e.preventDefault();
            $.ajax({
                url : $(this).attr('action') || window.location.pathname,
                type: "POST",
                data: $(this).serialize(),
                success: function (data) {
                    document.getElementById("message").value = ""
                },
                error: function (jXHR, textStatus, errorThrown) {
                    alert(errorThrown);
                }
            });
        });
    });
  </script>
</head>
<body>
  <h1>Chat away</h1>
    <form id = "myform" action="/chats/send" method="post">
    <label for="Message">Message:</label><br>
    <input type="text" id="message" name="message" value=""><br>
    <input type="hidden" id="chatId" name="chatId" value="{{chatId}}">
    <input type="submit" value="Send">


    <textarea class="form-control" id="messages" rows="14">
      {{#each messages}}
      {{this.byName}}: {{this.message}}
      {{/each}}
    </textarea>
  </form> 

  <br><br>

  <!-- <label for="messages">All messages:</label> -->
<!--   <textarea id="messages" name="messages" rows="4" cols="50">
{{#each messages}}
{{this.byName}}: {{this.message}}
{{/each}}
  </textarea> -->

</body>